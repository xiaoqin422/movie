<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>
        文章添加
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/index.css">
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/index.js"></script>
</head>
<body>

<div class="layui-card">
    <form class="layui-form layui-form-pane"  id="add">
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>电影名
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" id="movie_cn_name" name="movie_cn_name" autocomplete="off"  placeholder="电影名称"
                                   class="layui-input" lay-verify="required">
                            <input type="hidden" name="type_m" id="type_m" value="add">
                        </div>
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>电影又名
                        </label>
                        <div class="layui-input-inline">
                            <input type="hidden" id="movie_id" name="movie_id">
                            <input type="text" id="movie_fg_name" name="movie_fg_name" autocomplete="off" placeholder="电影又名"
                                   class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>导演
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" id="movie_director" name="movie_director" lay-verify="required" autocomplete="off" value="" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>主要演员
                        </label>
                        <div class="layui-input-block">
                            <input type="text" name="movie_actor" id="movie_actor" lay-verify="required" autocomplete="off" value="" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>电影类别
                        </label>
                        <div class="layui-input-inline">
                            <select name="movie_type" id="movie_type" lay-verify="required" >
                                <option value="">---请选择商品分类类型---</option>
                                <option value="搞笑">搞笑</option>
                                <option value="动漫">动漫</option>
                                <option value="恐怖">恐怖</option>
                                <option value="爱情">爱情</option>
                                <option value="抗战">抗战</option>
                            </select>
                        </div>
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>电影制片商(国家)
                        </label>
                        <div class="layui-input-inline">
                            <select name="movie_country" id="movie_country" lay-verify="required">
                                <option value="">---请选择商品品牌---</option>
                                <option value="国产">国产</option>
                                <option value="欧美">欧美</option>
                                <option value="日韩">日韩</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item imgs" id="imgshow">
                        <label class="layui-form-label">电影海报
                        </label>
                        <div class="layui-input-block">
                            <input type="text" id="movie_picture" name="movie_picture" value="images/UserHead/head.png"
                                   class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>电影时长
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" name="movie_duration" id="movie_duration" autocomplete="off"  placeholder="输入完整时长：120分钟"
                                   class="layui-input" lay-verify="required">
                        </div>
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>评分
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" name="movie_score" id="movie_score" autocomplete="off" value="" placeholder="输入数字"
                                   class="layui-input" lay-verify="required|number_user">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>票房
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" name="movie_boxOffice" lay-verify="required|number_user" id="movie_boxOffice" placeholder="输入数字" autocomplete="off" value="" class="layui-input">
                        </div>
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>评论数
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" name="movie_commentCount" placeholder="输入数字" id="movie_commentCount" lay-verify="required|number_user" autocomplete="off" value="" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class='x-red'>*</span>是否上映
                        </label>
                        <div class="layui-input-block">
                            <input type="radio" name="movie_state" value="1" title="上映" checked="">
                            <input type="radio" name="movie_state" value="0" title="下架">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label for="movie_releaseDate" class="layui-form-label">
                            <span class="x-red">*</span>上映日期</label>
                        <div class="layui-input-inline">
                            <input class="layui-input"  placeholder="上映日期" name="movie_releaseDate" lay-verify="required" id="movie_releaseDate"></div>
                    </div>
                    <div class="layui-form-item">
                        <label for="movie_detail" class="layui-form-label">
                            <span class="x-red">*</span>影片简介
                        </label>
                        <div class="layui-input-block">
                            <textarea id="movie_detail" placeholder="请输入电影简介" lay-verify="required" name="movie_detail"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <input class="layui-btn" type="button" id="submit" lay-filter="add" lay-submit="" value="添加">
                    </div>
                </div>
            </div>
    </form>
</div>
<script src="lib/layui/layui.js" type="text/javascript"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述 JS 路径需要改成你本地的 -->
<script>
    layui.config({
        base: 'lib/layui/lay/xFile/' //layui自定义layui组件目录
    }).use(['form', 'layer', 'xFile','laydate'], function () {
        var form = layui.form,
            layer = layui.layer;
        var xFile = layui.xFile;
        var laydate = layui.laydate;
        $ = layui.jquery;
        //日期
        laydate.render({
            elem: '#movie_releaseDate'
        });

        //自定义验证规则
        form.verify({
            number_user:[/^(\-|\+)?\d+(\.\d+)?/, '格式为非负小数，且不能出现空格']
        });
        //创建一个头像上传组件
        let initValues = [
            {
                file_id: '10101010101', // 文件id
                file_name: '海报图.jpg', // 文件名称
                file_suffix: 'jpg', // 文件后缀名
                file_url: '123', // 文件预览地址
            },
        ]
        xFile.render({
            id: 'movie_picture',
            base: 'lib/layui/lay/xFile/',
            url: 'upload?method=movie',
            cropImages: true,//是否裁剪
            accept: 'images',
            multiple: false,//是否多文件
            cropWidth: 190, // 裁剪图片宽度
            cropHeight: 315, // 裁剪图片高度
            auto: true,//自动上传
            rewriteFormValue: function (values) {
                let value = []
                if (values) {
                    values.forEach(function (val) {
                        value.push(val.file_id);
                    })
                }
                return value.join(",");
            },
            initValues: initValues,
        });
        //监听提交
        form.on('submit(add)', function (data) {
            $.ajax({
                url: 'Movie',
                type: 'post',
                beforeSend: function () { //当一个Ajax请求开始时触发
                    layer.load(0, {time: 3 * 1000}); //打开layui加载效果
                },
                data: {
                    "method": data.field.type_m,
                    "form": JSON.stringify(data.field),
                },
                dataType: 'JSON', //提交的数据格式为JSON,返回的数据格式也是json
                success: function (data) {
                    layer.close(layer.index);
                    if (data.code == 1) {
                        layer.alert(data.msg, {
                                icon: 6
                            },
                            function () {
                                //关闭当前frame
                                xadmin.close();
                                // 可以对父窗口进行刷新
                                xadmin.father_reload();
                            });
                    } else {
                        layer.msg(data.msg, function () {
                        });
                    }
                },
                error: function (data) {
                    layer.close(layer.index);
                    alert("服务器超时,请联系管理员！");
                }

            })
            return false;
        });
    });
</script>
</body>
</html>